apiVersion: deployments.plural.sh/v1alpha1
kind: ServiceDeployment
metadata:
  name: test-lua-functions
  namespace: scaffold-test
spec:
  namespace: test-lua-functions
  name: test-lua-functions
  repositoryRef:
    kind: GitRepository
    name: scaffold-test
    namespace: scaffold-test
  git:
    ref: main
    folder: /charts/simple-helm-nginx
  helm:
    luaScript: |
      values = {}
      valuesFiles = {}
      local content, err = fs.walk(".")
      assert(content, "Expected fs.walk to return files, but got error: " .. (err or "nil"))
      
      -- Count number of entries
      local count = 0
      for _ in pairs(content) do
        count = count + 1
      end

      -- Assert expected number
      local expected = 9
      assert(count == expected, "Expected " .. expected .. " files, but got: " .. count)
  clusterRef:
    name: existing
    namespace: scaffold-test